#!/usr/bin/env python
# encoding: utf-8
"""
toc-converter.py

Convert tables of content into happy XHTML.
"""

import sys
import os

def tidyUp (s):
  s = s.replace ("&", "&amp;")
  s = s.replace ("...", "&hellip;")
  s = s.replace ("'", "&rsquo;")
  s = s.replace ("\"", "&quot;")
  s = s.replace ("-", "&ndash;")
  return s

def printThatShit (lines, inputFile):
  f = open (inputFile + ".html", 'w')
  f.write ("<dl>\n")
  for i in range (len (lines)):
    if (i % 2 == 0):
      author = lines [i].split (',') [-1].strip ()
      title = lines [i] [0:-1 * len (author)]
      title = tidyUp (title)
      f.write ("<dt>")
      f.write (title)
      f.write ("<em>")
      f.write (author)
      f.write ("</em>")
      f.write ("</dt>\n")
    else:
      f.write ("<dd>")
      desc = lines [i]
      if (desc [-1] not in ".!?"):
        desc += "."
      desc = tidyUp (desc)
      f.write (desc)
      f.write ("</dd>\n")
  f.write ("</dl>\n")
  f.close ()

def main():
  inputFile = sys.argv [1]
  f = open (inputFile, 'r')
  lines = [x.strip () for x in f.readlines ()]
  lines = filter (lambda x: x != "", lines)
  f.close ()
  printThatShit (lines, inputFile)

if __name__ == '__main__':
  main()

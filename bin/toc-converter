#!/usr/bin/env python
# encoding: utf-8
"""
toc-converter.py

Convert tables of content into happy XHTML.
"""

import sys
import os

def replace_glyphs(s):
  s = s.replace ("&", "&amp;")
  s = s.replace ("...", "&hellip;")
  s = s.replace ("'", "&rsquo;")
  s = s.replace ("\"", "&quot;")
  s = s.replace (" - ", "&mdash;")
  s = s.replace ("  ", " ")
  return s

def print_html(lines, input_file):
  print "<dl>"
  for i in range(len(lines)):
    if (i % 2 == 0):
      author = replace_glyphs(lines[i].split(',')[-1].strip())
      title = lines[i][0:-1 * len(author)]
      title = replace_glyphs(title)
      print "  <dt>" + title + "<em>" + author + "</em>" + "</dt>"
    else:
      desc = lines[i]
      if (desc[-1] not in ".!?"):
        desc += "."
      desc = replace_glyphs(desc)

      print "  <dd>" + desc + "</dd>\n"
  print "</dl>"

def main():
  input_file = sys.argv[1]
  f = open(input_file, 'r')
  lines = [x.strip() for x in f.readlines()]
  lines = filter(lambda x: x != "", lines)
  f.close()
  print_html(lines, input_file)

if __name__ == '__main__':
  main()
